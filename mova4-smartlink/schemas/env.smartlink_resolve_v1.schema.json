{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mova.dev/schemas/env.smartlink_resolve_v1.schema.json",
  "title": "env.smartlink_resolve_v1",
  "description": "Envelope (speech-act) for resolving a SmartLink click to a target URL. This envelope describes the interface contract between the caller and executor, not the implementation. Part of SmartLink MOVA 4.0.0 implementation.",
  "type": "object",
  "properties": {
    "envelope_id": {
      "type": "string",
      "const": "env.smartlink_resolve_v1",
      "description": "Canonical identifier for this envelope type."
    },
    "verb": {
      "type": "string",
      "const": "route",
      "description": "MOVA verb: route (choose among targets based on context)."
    },
    "correlation_id": {
      "type": "string",
      "description": "Unique identifier for this specific resolution request (for tracing and correlation)."
    },
    "roles": {
      "type": "object",
      "description": "Roles involved in this speech-act.",
      "properties": {
        "requester": {
          "type": "string",
          "description": "Who is requesting the resolution (e.g., 'edge-worker', 'api-client')."
        },
        "executor": {
          "type": "string",
          "description": "Who will execute the resolution (e.g., 'smartlink-worker-v1', 'routing-agent')."
        }
      },
      "required": [
        "requester",
        "executor"
      ],
      "additionalProperties": false
    },
    "payload": {
      "type": "object",
      "description": "The data payload for resolution.",
      "properties": {
        "input": {
          "$ref": "ds.smartlink_click_context_v1.schema.json",
          "description": "The click context to resolve."
        },
        "config": {
          "oneOf": [
            {
              "$ref": "ds.smartlink_config_v1.schema.json",
              "description": "Full SmartLink configuration (inline)."
            },
            {
              "type": "object",
              "properties": {
                "config_ref": {
                  "type": "string",
                  "description": "Reference to SmartLink config (e.g., KV key, URL, or other identifier)."
                }
              },
              "required": [
                "config_ref"
              ],
              "additionalProperties": false
            }
          ],
          "description": "SmartLink configuration (inline or by reference)."
        },
        "output": {
          "$ref": "ds.smartlink_resolution_result_v1.schema.json",
          "description": "The resolution result (populated by executor in response)."
        }
      },
      "required": [
        "input"
      ],
      "additionalProperties": false
    },
    "meta": {
      "type": "object",
      "description": "Optional metadata for tracking, timestamps, etc.",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of the request."
        },
        "trace_id": {
          "type": "string",
          "description": "Distributed trace identifier."
        },
        "request_id": {
          "type": "string",
          "description": "Unique request identifier."
        }
      },
      "additionalProperties": true
    }
  },
  "required": [
    "envelope_id",
    "verb",
    "roles",
    "payload"
  ],
  "additionalProperties": false
}
